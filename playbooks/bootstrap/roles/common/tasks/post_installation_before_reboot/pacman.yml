---
- name: Ensure that pacman is configured.
  template:
    src: pacman.conf.j2
    dest: /etc/pacman.conf

- name: Ensure that packages are installed.
  pacman:
    name: "{{ item }}"
    state: present
  with_items:
    - which
    - vi
    - vim
    - neovim
    - python3
    - python-pip
    - bash-completion
    - archlinux-keyring

- name: Ensure that archlinux-keyring is installed.
  pacman:
    name: archlinux-keyring
    state: present
  register: archlinux_keyring_result

- name: Ensure that keys are loaded.
  shell: pacman-key --populate archlinux
  when: archlinux_keyring_result.changed

- name: Ensure that keys are refreshed.
  shell: pacman-key --refresh-keys
  when: archlinux_keyring_result.changed

- name: Ensure that all packages are upgraded.
  shell: pacman -Syu
  when: archlinux_keyring_result.changed
